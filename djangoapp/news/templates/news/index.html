

{% extends "news/base.html" %}

{% block content %}
{% load crispy_forms_tags %}


<form method="post" action="{% url 'news:scrape_articles' %}">
  {% csrf_token %}
  
  <div class="container">
    <div class="m-0 p-0 mb-1 d-flex justify-content-between align-items-center">
      <h2>Choose sites:</h2>

      {{form.clickbait_tolerance|as_crispy_field}}

      <button class="btn btn-success" type="submit">Scrape</button>
    </div>

    <div class="row p-0 m-0">

      <div class="col-md-2 form-check p-1">
        {{ form.thesun|as_crispy_field }}
      </div>
      <div class="col-md-2 form-check p-1">
        {{ form.cbsnews|as_crispy_field }}
      </div>
      <div class="col-md-2 form-check p-1">
        {{ form.abcnews|as_crispy_field }}
      </div>
    </div>
  </div>
  {{form.category|as_crispy_field}}
</form>

<div class="container mt-2-3">
  <div class="m-0 p-0 mb-1 d-flex justify-content-between align-items-center">
    <h2>Results:</h2>
  {% include 'news/list_articles.html' %}
</div>




<div id="detailsSection">
  
</div>

<div id="article-container">
  <!-- Existing articles -->
  {% for article in articles %}
      <div class="article">
          <h3>{{ article.title }}</h3>
          <p>{{ article.content }}</p>
          <!-- Add other article details as needed -->
      </div>
  {% endfor %}
</div>

<!-- Load More Button -->
<button id="load-more-btn">Load More</button>

<script>
  document.getElementById('load-more-btn').addEventListener('click', function() {
      fetch('{% url "news:load_more_articles" %}')
          .then(response => response.json())
          .then(data => {
              // Check if data.articles is a string (HTML for a single article)
              if (typeof data.articles === 'string') {
                  const articleContainer = document.getElementById('article-container');
                  const articleDiv = document.createElement('div');
                  articleDiv.className = 'article';
                  articleDiv.innerHTML = data.articles;
                  articleContainer.appendChild(articleDiv);
              } else if (Array.isArray(data.articles)) {
                  // If data.articles is an array, iterate over it
                  const articleContainer = document.getElementById('article-container');
                  data.articles.forEach(articleHtml => {
                      const articleDiv = document.createElement('div');
                      articleDiv.className = 'article';
                      articleDiv.innerHTML = articleHtml;
                      articleContainer.appendChild(articleDiv);
                  });
              } else {
                  // Handle other scenarios if needed
              }
          })
          .catch(error => {
              console.error('Error fetching articles:', error);
          });
  });
</script>

{% endblock %}
